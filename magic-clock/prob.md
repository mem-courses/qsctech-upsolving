# 魔法时钟(Magic Clock)
如果您喜欢故事，喜欢奇思妙想，那么欢迎登上前往异世界小镇的列车！但是，为了激发各位准潮人的开发与学习热情，这个任务**前端零基础者/产品方向的同学**优先。如果您认识`H5 Canvas`，或已经开发过一些网站，则应该试着去尝试其他题目，因为本题可能对您过于简单。本题无需非常硬核的知识，只需要学习

- 前端的一些`javaScript`知识
- node.js环境的简单配置
- 充分利用搜索引擎解决问题

甚至无需掌握`HTML`和`css`（这两个可以在任务完成之后再慢慢摸索）。我们将尽力让这次旅程有趣、愉快，并对之后的项目合作有所帮助。
</br>
</br>

> 不知从多少年前开始，小镇的时间就流逝得飞快，一刻不停。
> 
> 明明刚才还是玉树临风的少年，眨眼间却成为两鬓苍苍的老叟。因此，居民们不是处于对时间的焦虑之中，就是在苦涩地悔恨不成样的过去。
> 
> 作为拥有魔法的创世主，您需要做的，是制造魔法时钟，让钟摆停转，指针垂落，令那些日日夜夜奔波劳苦的居民，得到片刻的宁静，拥抱美好的瞬间。

</br>
</br>
</br>

## 1.了解小镇
与隔壁其他几个任务一样，为了更方便地查看、编辑代码，推荐您下载`vscode`。~~对于这个小任务而言，主要是一些提示和标注，会让不长记性，容易拼错变量的我方便一些~~。
以下就是这个任务中各个文件夹和文件的功能介绍。

- 根目录（主要需要关注的内容）
    - `index.html`，这就是我们页面的入口，所有的内容都会在上面呈现，您可以打开它看下里面的`<canvas>`标签，是用于画图的。其中一个是用来画小镇的，另一个是留给您画魔法时钟的。
    - `magicClock.js`，目前是空的，创世主之后要在其中编写好时钟的逻辑脚本。

- `jpgSeq`文件夹
   
   里面存放着影片的jpg图形序列，用于形成动画。

- `server`文件夹

   存放着一些任务进度信息和对话信息，和一个小小的虚拟服务器，之后在“ 3.联系居民 ” 部分，您会知道如何简单便捷地启动它。

- `src`文件夹
   
   里面的资源有点杂，但从完成任务的角度出发，您只需要关注 “ 2.摆个模样 ”中提及的资源即可。
</br>
</br>
</br>

## 2. 摆个模样
在本任务的目录`./src`中，存放有制作魔法时钟需要的材料。
- `ClockBoard.png`，是时钟的表盘
- `HourHand.png `，是时钟的时针
- `MinuteHand.png`，是时e钟的分针
- `tick1.mp3、tick2.mp3、tick3.mp3`，都是时钟滴答的音效（但如果您觉得滴答滴答的太烦了，可以不使用它们）
- 剩下的.mp3、.svg、.js代码文件，您可以不去理会它们，在任务完成之后再探索。

那么如何制作呢？您需要简单地学习**HTML5 Canvas**，以在画布上画出这些图形，以下是一些学习的资源：

<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Basic_usage">
Canvas基本使用</a>

在本任务中，由于canvas元素的id是"ClockCanvas"，您可以这样获取到Canvas元素的对象。
```js
const canvas=getElementById("ClockCanvas");
```
</br>
接着我们需要在上面画一些东西。
</br>
<a href="https://blog.csdn.net/sleepwalker_1992/article/details/80571346">Canvas绘制图片</a>
</br>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Transformations">Canvas变形</a>
</br>
</br>
</br>
</br>

## 3.联系居民
是的，作为创世主，您需要听听居民的声音，以获得一些反馈。但是，居民的谈话都发生在`./server/AllDialogs.b64`这样一个奇奇怪怪的文件中，无法传递到创世主的页面。但幸运的是，您可以简单地启动一些代码，让这些对话直接传输到浏览器窗口上。

操作非常简单：
1. 首先，下载前端开发工具node.js，同时里面会带有包管理器npm：进入<a href="https://nodejs.org/zh-cn/download">node.js的官网</a>，按照网上的教程安装即可。
2. 接着，进入`server`文件夹，鼠标右键，选择“在终端中打开”，这样你会在该目录下打开黑黑的命令框。
3. 在命令框中敲下
    ```cmd
    npm install
    ```
    静等其完成，便可以安装好服务器启动需要的全部依赖。
4. 最后在server目录下的终端窗口输入
    ```cmd
    npm start
    ```
    便可以启动服务器了。之后若关闭终端窗口，每次启动只需要输入这一句`npm start`就好。在进行 “4.制作时钟” 、“5.任务交付” 的时候，你可以保持这个终端窗口的打开状态，这样在任务有进展的时候，你就会收到居民的对话！

需要注意的是，如果你在上述步骤中遇到什么问题，请善用搜索引擎解决。

如有兴趣，你可以在任务完成后，系统地学习node.js和前端框架Vue、React等，进一步了解这里面的原理，跑步进入动态页面的开发。（X）


> ### Question1
> 
> 能否简单解释一下`npm start`命令所做的事情，在这个过程中，`nodejs`承担了什么角色？
> 

</br>
</br>
</br>

## 4. 制作时钟
为了让时钟与动画发生交互，你可以直接使用以下函数(细心的你或许已经在`index.html`中留意到了它们)
- `getTime():string` 

    参数：无 

    返回值：一个字符串，格式为HH:MM(二十四小时制)，表示当前小镇的时间。

    你可以先在`magicClock.js`中使用以下代码，打开浏览器，按F12以打开控制台，来看看每个500毫秒的时间变化：
    ```js
    function printTime(){
        console.log(getTime());
    }
    setInterval(printTime,500);
    ```
    它成功了。但在之后，你自己也要自己使用`setInterval()`和`console.log()`，所以你需要善用搜索引擎，以学会使用它们。
- `freezeTime():void`
    
    参数：无

    返回值：无
    
    功能：调用此函数可以使动画停止，冻结时间。

- `meltTime():void`

    参数：无

    返回值：无
    
    功能：调用此函数可以使动画恢复播放，时间继续流逝。
- `setTime(time:string):void`
  
    参数：time，一个字符串，格式为HH:MM（二十四小时制），与getTime()获取到的字符串格式相同。

    返回值：无。

    功能：调用此函数可以设置时间，让动画跳转到指定的时间点。
- `getIsTimePassing():boolean`

    参数：无

    返回值：一个布尔值，表示目前时间是否在流逝，即动画是否处于播放状态。
    功能：调用此函数能知道目前时间是否在流逝。例如，若此前调用了`freezeTime()`，则会返回`false`。

您应该猜到了，需要两个数据转化函数，一个将时针和分针转动的角度转化为HH:MM的时间格式；另一个则反过来，HH:MM字符串转化为时针和分针转动的角度。
此外，需要注意的是，如果你的时针是12小时一圈，那么2点对应的可能是02:00，也可能是14:00，这就不一一对应了，因此您还需要想办法，让这个钟表做得更易读、合理:)

那我们就开始吧！

（1）首先是让时钟随时间流逝而转动，这些视觉上的效果，其实背后只是数据格式的转换。

（2）接着是让时间停止，这时候需要你写一些互动，即，当点击插销时，它的y坐标会随着鼠标移动而改变。

>你需要了解`addEventListener()`方法，并使用`offsetX`和`offsetY`。请多使用搜索引擎，你一定可以的！


（3）最后是根据表盘时间来`setTime()`，你可能要使用到反三角函数，将**相对于表盘中心的鼠标点击坐标**转化为**弧度**。接着将弧度转化为HH:MM的字符串形式即可。

>为了让时间的流逝和跳转更为流畅，看上去像视频的快进和快退一样，推荐使用`window.requestAnimationFrame`或`setInterval`，多次调用`setTime`，以达到连续变换的动画效果。

</br>

> ### Question2
>
> 在添加鼠标点击事件的侦听时，`e.offsetX`和`e.offsetY`的含义是什么？它们和`e.clientX`和`e.clientY`以及其他表示点击位置的参量有什么区别？
>
> ### Question3
> 你能想到其他“控制时间”的方式吗？比如抛弃canvas，做一个滑动条等等。一些类似的整活UI设计可以参考：
> 
> <a href="https://zhuanlan.zhihu.com/p/29218345 ">脑残的音量控制器设计</a>
> 
> 欢迎提出、实践你自己的想法！

</br>
</br>
</br>

## 5. 任务交付

这是一个完成后的demo，插上插销，可以让时间暂停一会儿；拨动时针，可以让时间回到过去或未来。

<img src="src/demo.gif" alt="demo演示"/>

如果你已经制作了可以控制时间的时钟，那么，是时候把它交付给小镇的居民了。尝试着，
**插上插销，依次拨动时针到6点、9点、12点、15点、18点和21点**
，小镇的报时人会敏锐地发现时间的停滞。这时，镇上所有的居民，都将收到你的惊喜！


> ### Question4
>
> 注意: **此题为必答题, 选择本试题的面试者请务必对该问题作出回答**
>
> 在完成整个项目的过程中, 你有什么心得和体会?
>
> 你觉得这篇文章你可以打几分? (满分 10, 保留到整数即可) 如此评分的原因是什么？还有什么意见或建议？
>
> 你还有什么想说的?

</br>
</br>
</br>

## 6. 写在最后
虽然制作好了时钟，但相信你对这个异世界小镇的其他部分也感兴趣，比如，一些简单的帧动画；浏览器的网页和用`npm start`启动的服务器之间是怎么交互的；任务进度的数据是怎么保存的，等等。待你稍加了解相关知识，你很快就会做得更好，相信你一定会有 “这也没什么嘛，我也能做到，能写得更好，更优雅” 的自信心。

感谢你的参与，祝你游玩愉快！

音乐来源：八云轨《秒·繁星》《秒·莹露》《秒·落樱》。仅用于学习，侵权必删。